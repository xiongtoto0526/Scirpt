export default class Metastore {
    constructor(namespace) {
        this.namespace = namespace;
    }
    _map(obj, key) {
        if (!Reflect.hasOwnMetadata(this.namespace, obj, key)) {
            Reflect.defineMetadata(this.namespace, new Map(), obj, key);
        }
        return Reflect.getOwnMetadata(this.namespace, obj, key);
    }
    get(key, obj, prop) {
        return this._map(obj, prop).get(key);
    }
    set(key, value, obj, prop) {
        this._map(obj, prop).set(key, value);
    }
    has(key, obj, prop) {
        return this._map(obj, prop).has(key);
    }
    push(key, value, obj, prop) {
        if (!this.has(key, obj, prop)) {
            this.set(key, [], obj, prop);
        }
        let store = this.get(key, obj, prop);
        if (!Array.isArray(store)) {
            throw new Error('Metastores can only push metadata to array values');
        }
        store.push(value);
    }
    merge(key, value, obj, prop) {
        let previous = this.get(key, obj, prop) || {};
        let mergedObj = Object.assign({}, previous, value);
        this.set(key, mergedObj, obj, prop);
    }
    forEach(callbackFn, obj, prop) {
        this._map(obj, prop).forEach(callbackFn);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jbGFzc2VzL21ldGFzdG9yZS50cyJdLCJuYW1lcyI6WyJNZXRhc3RvcmUiLCJNZXRhc3RvcmUuY29uc3RydWN0b3IiLCJNZXRhc3RvcmUuX21hcCIsIk1ldGFzdG9yZS5nZXQiLCJNZXRhc3RvcmUuc2V0IiwiTWV0YXN0b3JlLmhhcyIsIk1ldGFzdG9yZS5wdXNoIiwiTWV0YXN0b3JlLm1lcmdlIiwiTWV0YXN0b3JlLmZvckVhY2giXSwibWFwcGluZ3MiOiJBQUFBO0lBQ0NBLFlBQW9CQSxTQUFnQkE7UUFBaEJDLGNBQVNBLEdBQVRBLFNBQVNBLENBQU9BO0lBRXBDQSxDQUFDQTtJQUVPRCxJQUFJQSxDQUFDQSxHQUFRQSxFQUFFQSxHQUFZQTtRQUNsQ0UsRUFBRUEsQ0FBQUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQUEsQ0FBQ0E7WUFDckRBLE9BQU9BLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLElBQUlBLEdBQUdBLEVBQUVBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO1FBQzdEQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxjQUFjQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUN6REEsQ0FBQ0E7SUFFREYsR0FBR0EsQ0FBQ0EsR0FBUUEsRUFBRUEsR0FBUUEsRUFBRUEsSUFBYUE7UUFDcENHLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQ3RDQSxDQUFDQTtJQUVESCxHQUFHQSxDQUFDQSxHQUFRQSxFQUFFQSxLQUFVQSxFQUFFQSxHQUFRQSxFQUFFQSxJQUFhQTtRQUNoREksSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDdENBLENBQUNBO0lBRURKLEdBQUdBLENBQUNBLEdBQVFBLEVBQUVBLEdBQVFBLEVBQUVBLElBQWFBO1FBQ3BDSyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUN0Q0EsQ0FBQ0E7SUFFREwsSUFBSUEsQ0FBQ0EsR0FBUUEsRUFBRUEsS0FBVUEsRUFBRUEsR0FBUUEsRUFBRUEsSUFBYUE7UUFDakRNLEVBQUVBLENBQUFBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBLENBQUFBLENBQUNBO1lBQzdCQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxFQUFFQSxFQUFFQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM5QkEsQ0FBQ0E7UUFFREEsSUFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFckNBLEVBQUVBLENBQUFBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUFBLENBQUNBO1lBQ3pCQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSxtREFBbURBLENBQUNBLENBQUNBO1FBQ3RFQSxDQUFDQTtRQUVEQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtJQUNuQkEsQ0FBQ0E7SUFFRE4sS0FBS0EsQ0FBQ0EsR0FBUUEsRUFBRUEsS0FBVUEsRUFBRUEsR0FBUUEsRUFBRUEsSUFBYUE7UUFDbERPLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO1FBQzlDQSxJQUFJQSxTQUFTQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxFQUFFQSxRQUFRQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUM3Q0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsU0FBU0EsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDM0NBLENBQUNBO0lBRURQLE9BQU9BLENBQUNBLFVBQWdFQSxFQUFFQSxHQUFRQSxFQUFFQSxJQUFhQTtRQUNoR1EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0E7SUFDMUNBLENBQUNBO0FBQ0ZSLENBQUNBO0FBQUEiLCJmaWxlIjoibGliL2NsYXNzZXMvbWV0YXN0b3JlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWV0YXN0b3Jle1xuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIG5hbWVzcGFjZTpzdHJpbmcpe1xuXHRcdFxuXHR9XG5cdFxuXHRwcml2YXRlIF9tYXAob2JqOiBhbnksIGtleT86IHN0cmluZyk6IE1hcDxhbnksYW55Pntcblx0XHRpZighUmVmbGVjdC5oYXNPd25NZXRhZGF0YSh0aGlzLm5hbWVzcGFjZSwgb2JqLCBrZXkpKXtcblx0XHRcdFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEodGhpcy5uYW1lc3BhY2UsIG5ldyBNYXAoKSwgb2JqLCBrZXkpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gUmVmbGVjdC5nZXRPd25NZXRhZGF0YSh0aGlzLm5hbWVzcGFjZSwgb2JqLCBrZXkpO1xuXHR9XG5cdFxuXHRnZXQoa2V5OiBhbnksIG9iajogYW55LCBwcm9wPzogc3RyaW5nKTogYW55e1xuXHRcdHJldHVybiB0aGlzLl9tYXAob2JqLCBwcm9wKS5nZXQoa2V5KTtcblx0fVxuXHRcblx0c2V0KGtleTogYW55LCB2YWx1ZTogYW55LCBvYmo6IGFueSwgcHJvcD86IHN0cmluZyl7XG5cdFx0dGhpcy5fbWFwKG9iaiwgcHJvcCkuc2V0KGtleSwgdmFsdWUpO1xuXHR9XG5cdFxuXHRoYXMoa2V5OiBhbnksIG9iajogYW55LCBwcm9wPzogc3RyaW5nKTogYm9vbGVhbntcblx0XHRyZXR1cm4gdGhpcy5fbWFwKG9iaiwgcHJvcCkuaGFzKGtleSk7XG5cdH1cblx0XG5cdHB1c2goa2V5OiBhbnksIHZhbHVlOiBhbnksIG9iajogYW55LCBwcm9wPzogc3RyaW5nKXtcblx0XHRpZighdGhpcy5oYXMoa2V5LCBvYmosIHByb3ApKXtcblx0XHRcdHRoaXMuc2V0KGtleSwgW10sIG9iaiwgcHJvcCk7XG5cdFx0fVxuXHRcdFxuXHRcdGxldCBzdG9yZSA9IHRoaXMuZ2V0KGtleSwgb2JqLCBwcm9wKTtcblx0XHRcblx0XHRpZighQXJyYXkuaXNBcnJheShzdG9yZSkpe1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdNZXRhc3RvcmVzIGNhbiBvbmx5IHB1c2ggbWV0YWRhdGEgdG8gYXJyYXkgdmFsdWVzJyk7XG5cdFx0fVxuXHRcdFxuXHRcdHN0b3JlLnB1c2godmFsdWUpO1xuXHR9XG5cblx0bWVyZ2Uoa2V5OiBhbnksIHZhbHVlOiBhbnksIG9iajogYW55LCBwcm9wPzogc3RyaW5nKSB7XG5cdFx0bGV0IHByZXZpb3VzID0gdGhpcy5nZXQoa2V5LCBvYmosIHByb3ApIHx8IHt9O1xuXHRcdGxldCBtZXJnZWRPYmogPSBPYmplY3QuYXNzaWduKHt9LCBwcmV2aW91cywgdmFsdWUpO1xuICAgICAgICB0aGlzLnNldChrZXksIG1lcmdlZE9iaiwgb2JqLCBwcm9wKTtcblx0fVxuXHRcblx0Zm9yRWFjaChjYWxsYmFja0ZuOiAodmFsdWU6IGFueSwgaW5kZXg6IGFueSwgbWFwOiBNYXA8YW55LCBhbnk+KSA9PiB2b2lkLCBvYmo6IGFueSwgcHJvcD86IHN0cmluZyl7XG5cdFx0dGhpcy5fbWFwKG9iaiwgcHJvcCkuZm9yRWFjaChjYWxsYmFja0ZuKTtcblx0fVxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
