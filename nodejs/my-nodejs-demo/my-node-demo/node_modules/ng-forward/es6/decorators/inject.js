import { bundleStore, providerStore } from '../writers';
import { getInjectableName } from '../util/get-injectable-name';
import { Providers } from '../decorators/providers';
import { OpaqueToken } from '../classes/opaque-token';
import { componentHooks } from './component';
export function Inject(...injects) {
    return function (t1, name, { value: t2 } = { value: undefined }) {
        const targetIsClass = arguments.length === 1;
        const t = targetIsClass ? t1 : t2;
        const notStringBased = (inj) => typeof inj !== 'string' && !(inj instanceof OpaqueToken);
        const ensureInjectable = (inj) => {
            if (!providerStore.get('name', inj) || !providerStore.get('type', inj)) {
                throw new Error(`Processing "${t.name}" @Inject parameter: "${inj.name || inj.toString()}" is not a valid injectable.
				Please ensure ${inj.name || inj.toString()} is injectable. Valid examples can be:
				- a string representing an ng1 provider, e.g. '$q'
				- an @Injectable ng-forward class
				- a Provider, e.g. provide(SOME_CONFIG, {asValue: 100})`);
            }
            return inj;
        };
        var providers = injects
            .filter(notStringBased)
            .map(ensureInjectable);
        Providers(...providers)(t, `while analyzing '${t.name}' injected providers`);
        let dependencies = injects.map(getInjectableName).filter(n => n !== undefined);
        if (bundleStore.has('$inject', t)) {
            let parentInjects = bundleStore.get('$inject', t);
            bundleStore.set('$inject', [...dependencies, ...parentInjects], t);
        }
        else {
            bundleStore.set('$inject', dependencies, t);
        }
    };
}
componentHooks.beforeCtrlInvoke(injectParentComponents);
function injectParentComponents(caller, injects, controller, ddo, $injector, locals) {
    injects.forEach((inject) => {
        if (!$injector.has(inject)) {
            let parent = locals.$element;
            do {
                if (!parent.controller)
                    continue;
                const parentCtrl = parent.controller(inject);
                if (parentCtrl) {
                    locals[inject] = parentCtrl;
                    return;
                }
            } while ((parent = parent.parent()) && parent.length > 0);
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kZWNvcmF0b3JzL2luamVjdC50cyJdLCJuYW1lcyI6WyJJbmplY3QiLCJpbmplY3RQYXJlbnRDb21wb25lbnRzIl0sIm1hcHBpbmdzIjoiT0FlTyxFQUFDLFdBQVcsRUFBRSxhQUFhLEVBQUMsTUFBTSxZQUFZO09BQzlDLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSw2QkFBNkI7T0FDdEQsRUFBQyxTQUFTLEVBQUMsTUFBTSx5QkFBeUI7T0FDMUMsRUFBQyxXQUFXLEVBQUMsTUFBTSx5QkFBeUI7T0FDNUMsRUFBQyxjQUFjLEVBQUMsTUFBTSxhQUFhO0FBSTFDLHVCQUF3QixHQUFHLE9BQWM7SUFDeENBLE1BQU1BLENBQUNBLFVBQVNBLEVBQU1BLEVBQUVBLElBQWFBLEVBQUVBLEVBQUNBLEtBQUtBLEVBQUVBLEVBQUVBLEVBQUNBLEdBQUdBLEVBQUNBLEtBQUtBLEVBQUVBLFNBQVNBLEVBQUNBO1FBSXRFLE1BQU0sYUFBYSxHQUFHLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1FBQzdDLE1BQU0sQ0FBQyxHQUFHLGFBQWEsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBRWxDLE1BQU0sY0FBYyxHQUFHLENBQUMsR0FBUSxLQUFLLE9BQU8sR0FBRyxLQUFLLFFBQVEsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLFdBQVcsQ0FBQyxDQUFDO1FBQzlGLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxHQUFRO1lBQ2pDLEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hFLE1BQU0sSUFBSSxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSx5QkFBeUIsR0FBRyxDQUFDLElBQUksSUFBSSxHQUFHLENBQUMsUUFBUSxFQUFFO29CQUN4RSxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxRQUFRLEVBQUU7Ozs0REFHYyxDQUFDLENBQUE7WUFDMUQsQ0FBQztZQUNELE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDWixDQUFDLENBQUM7UUFPRixJQUFJLFNBQVMsR0FBRyxPQUFPO2FBQ3BCLE1BQU0sQ0FBQyxjQUFjLENBQUM7YUFDdEIsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFFekIsU0FBUyxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLG9CQUFvQixDQUFDLENBQUMsSUFBSSxzQkFBc0IsQ0FBQyxDQUFDO1FBRTdFLElBQUksWUFBWSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQztRQWdCL0UsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25DLElBQUksYUFBYSxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2xELFdBQVcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsR0FBRyxZQUFZLEVBQUUsR0FBRyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwRSxDQUFDO1FBRUQsSUFBSSxDQUFDLENBQUM7WUFDTCxXQUFXLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDN0MsQ0FBQztJQUNGLENBQUMsQ0FBQUE7QUFDRkEsQ0FBQ0E7QUFFRCxjQUFjLENBQUMsZ0JBQWdCLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQU14RCxnQ0FBZ0MsTUFBVyxFQUFFLE9BQWlCLEVBQUUsVUFBZSxFQUFFLEdBQVEsRUFBRSxTQUFjLEVBQUUsTUFBVztJQUNySEMsT0FBT0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsTUFBTUE7UUFDdEJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzVCQSxJQUFJQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQTtZQUU3QkEsR0FBR0EsQ0FBQ0E7Z0JBQ0hBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBO29CQUFDQSxRQUFRQSxDQUFDQTtnQkFDakNBLE1BQU1BLFVBQVVBLEdBQUdBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO2dCQUM3Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2hCQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxVQUFVQSxDQUFDQTtvQkFDNUJBLE1BQU1BLENBQUNBO2dCQUNSQSxDQUFDQTtZQUNGQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxJQUFJQSxNQUFNQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxFQUFFQTtRQUMzREEsQ0FBQ0E7SUFDRkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDSkEsQ0FBQ0EiLCJmaWxlIjoibGliL2RlY29yYXRvcnMvaW5qZWN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gIyBJbmplY3QgRGVjb3JhdG9yXG4vLyBEZWNvcmF0b3IgZm9yIGFkZGluZyBkZXBlbmRlbmNpZXMgdG8gYSBwcm92aWRlclxuLy9cbi8vICMjIFVzYWdlXG4vLyBJbmplY3Qgc3RyaW5nLWJhc2VkIGRlcGVuZGVuY2llcywgZGVjb3JhdGVkIGNsYXNzZXMsIG9yIGNsYXNzZXMgZGlyZWN0bHkgYXMgc2VydmljZXNcbi8vIGBgYGpzXG4vLyBpbXBvcnQge0luamVjdH0gZnJvbSAnbmctZm9yYXJkJztcbi8vXG4vLyBjbGFzcyBTb21lU2VydmljZXsgfVxuLy9cbi8vIEBJbmplY3QoJyRxJywgU29tZVNlcnZpY2UpXG4vLyBjbGFzcyBBbm90aGVyU2VydmljZXsgfVxuLy8gYGBgXG4vL1xuLy8gSW1wb3J0IHRoZSBhcHBXcml0ZXIgZm9yIHJlYWRpbmcgYW5kIHdyaXRpbmcgbWV0YWRhdGFcbmltcG9ydCB7YnVuZGxlU3RvcmUsIHByb3ZpZGVyU3RvcmV9IGZyb20gJy4uL3dyaXRlcnMnO1xuaW1wb3J0IHtnZXRJbmplY3RhYmxlTmFtZX0gZnJvbSAnLi4vdXRpbC9nZXQtaW5qZWN0YWJsZS1uYW1lJztcbmltcG9ydCB7UHJvdmlkZXJzfSBmcm9tICcuLi9kZWNvcmF0b3JzL3Byb3ZpZGVycyc7XG5pbXBvcnQge09wYXF1ZVRva2VufSBmcm9tICcuLi9jbGFzc2VzL29wYXF1ZS10b2tlbic7XG5pbXBvcnQge2NvbXBvbmVudEhvb2tzfSBmcm9tICcuL2NvbXBvbmVudCc7XG5cbi8vICMjIEBJbmplY3Rcbi8vIFRha2VzIGFuIGFycmF5IG9mIGluamVjdHNcbmV4cG9ydCBmdW5jdGlvbiBJbmplY3QoIC4uLmluamVjdHM6IGFueVtdICl7XG5cdHJldHVybiBmdW5jdGlvbih0MTphbnksIG5hbWU/OiBzdHJpbmcsIHt2YWx1ZTogdDJ9ID0ge3ZhbHVlOiB1bmRlZmluZWR9KXtcblxuXHRcdC8vIFdlIGNhbiB1c2UgQEluamVjdCBvbiBjbGFzc2VzIGFuZC0taW4gdGhlIGNhc2Ugb2YgdWktcm91dGVyIEBSZXNvbHZlIGRlY29yYXRvci0tc3RhdGljIG1ldGhvZHMuXG5cdFx0Ly8gSWYgd2UgdXNlIEBJbmplY3Qgb24gYSBzdGF0aWMgbWV0aG9kIHRoZW4gMyBhcmd1bWVudHMgYXJlIHBhc3NlZCBpbiwgaW5zdGVhZCBvZiBqdXN0IDEuXG5cdFx0Y29uc3QgdGFyZ2V0SXNDbGFzcyA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDE7XG5cdFx0Y29uc3QgdCA9IHRhcmdldElzQ2xhc3MgPyB0MSA6IHQyO1xuXG5cdFx0Y29uc3Qgbm90U3RyaW5nQmFzZWQgPSAoaW5qOiBhbnkpID0+IHR5cGVvZiBpbmogIT09ICdzdHJpbmcnICYmICEoaW5qIGluc3RhbmNlb2YgT3BhcXVlVG9rZW4pO1xuXHRcdGNvbnN0IGVuc3VyZUluamVjdGFibGUgPSAoaW5qOiBhbnkpID0+IHtcblx0XHRcdGlmICghcHJvdmlkZXJTdG9yZS5nZXQoJ25hbWUnLCBpbmopIHx8ICFwcm92aWRlclN0b3JlLmdldCgndHlwZScsIGluaikpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBQcm9jZXNzaW5nIFwiJHt0Lm5hbWV9XCIgQEluamVjdCBwYXJhbWV0ZXI6IFwiJHtpbmoubmFtZSB8fCBpbmoudG9TdHJpbmcoKX1cIiBpcyBub3QgYSB2YWxpZCBpbmplY3RhYmxlLlxuXHRcdFx0XHRQbGVhc2UgZW5zdXJlICR7aW5qLm5hbWUgfHwgaW5qLnRvU3RyaW5nKCl9IGlzIGluamVjdGFibGUuIFZhbGlkIGV4YW1wbGVzIGNhbiBiZTpcblx0XHRcdFx0LSBhIHN0cmluZyByZXByZXNlbnRpbmcgYW4gbmcxIHByb3ZpZGVyLCBlLmcuICckcSdcblx0XHRcdFx0LSBhbiBASW5qZWN0YWJsZSBuZy1mb3J3YXJkIGNsYXNzXG5cdFx0XHRcdC0gYSBQcm92aWRlciwgZS5nLiBwcm92aWRlKFNPTUVfQ09ORklHLCB7YXNWYWx1ZTogMTAwfSlgKVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGluajtcblx0XHR9O1xuXG5cblx0XHQvLyBBdCB0aGUgZW5kIG9mIHRoZSBkYXksIEFuZ3VsYXIgMSdzIERJIHJlcXVpcmVzIHRoZSBpbmplY3Rpb24gYXJyYXkgdG8gYmVcblx0XHQvLyBhbiBhcnJheSBvZiBzdHJpbmdzLiBNYXAgb3ZlciB0aGUgaW5qZWN0cyB0byBnZXQgdGhlIHN0cmluZyBwcm92aWRlciBuYW1lIGZvclxuXHRcdC8vIGVhY2ggaW5qZWN0YWJsZVxuXG5cdFx0dmFyIHByb3ZpZGVycyA9IGluamVjdHNcblx0XHRcdFx0LmZpbHRlcihub3RTdHJpbmdCYXNlZClcblx0XHRcdFx0Lm1hcChlbnN1cmVJbmplY3RhYmxlKTtcblxuXHRcdFByb3ZpZGVycyguLi5wcm92aWRlcnMpKHQsIGB3aGlsZSBhbmFseXppbmcgJyR7dC5uYW1lfScgaW5qZWN0ZWQgcHJvdmlkZXJzYCk7XG5cblx0XHRsZXQgZGVwZW5kZW5jaWVzID0gaW5qZWN0cy5tYXAoZ2V0SW5qZWN0YWJsZU5hbWUpLmZpbHRlcihuID0+IG4gIT09IHVuZGVmaW5lZCk7XG5cblx0XHQvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IGFuICRpbmplY3QgYXJyYXksIGFzc3VtZSB0aGF0IGl0IHdhcyBzZXQgYnkgYSBwYXJlbnQgY2xhc3MuXG5cdFx0Ly8gVGhlIHJlc3VsdGFudCAkaW5qZWN0IGFycmF5IHNob3VsZCBiZSBhIGNvbmNhdCBvZiBsb2NhbCBkZXBlbmRlbmNpZXMgYW5kIHBhcmVudFxuXHRcdC8vIGluamVjdHMuXG5cdFx0Ly8gYGBganNcblx0XHQvLyBASW5qZWN0KCckcScsICckaHR0cCcsICckaW50ZXJ2YWwnKVxuXHRcdC8vIGNsYXNzIFBhcmVudHsgLi4uIH1cblx0XHQvL1xuXHRcdC8vIEBJbmplY3QoJyR0aW1lb3V0Jylcblx0XHQvLyBjbGFzcyBDaGlsZCBleHRlbmRzIFBhcmVudHtcblx0XHQvLyBcdGNvbnN0cnVjdG9yKCR0aW1lb3V0LCAuLi5wYXJlbnREZXBlbmRlbmNpZXMpe1xuXHRcdC8vIFx0XHRzdXBlciguLi5wYXJlbnREZXBlbmRlbmNpZXMpO1xuXHRcdC8vIFx0fVxuXHRcdC8vIH1cblx0XHQvLyBgYGBcblx0XHRpZiAoYnVuZGxlU3RvcmUuaGFzKCckaW5qZWN0JywgdCkpIHtcblx0XHRcdGxldCBwYXJlbnRJbmplY3RzID0gYnVuZGxlU3RvcmUuZ2V0KCckaW5qZWN0JywgdCk7XG5cdFx0XHRidW5kbGVTdG9yZS5zZXQoJyRpbmplY3QnLCBbLi4uZGVwZW5kZW5jaWVzLCAuLi5wYXJlbnRJbmplY3RzXSwgdCk7XG5cdFx0fVxuXHRcdC8vIE90aGVyd2lzZSBqdXN0IHVzZSB0aGUgZGVwZW5kZW5jaWVzIGFycmF5IGFzIHRoZSAkaW5qZWN0IGFycmF5LlxuXHRcdGVsc2Uge1xuXHRcdFx0YnVuZGxlU3RvcmUuc2V0KCckaW5qZWN0JywgZGVwZW5kZW5jaWVzLCB0KTtcblx0XHR9XG5cdH1cbn1cblxuY29tcG9uZW50SG9va3MuYmVmb3JlQ3RybEludm9rZShpbmplY3RQYXJlbnRDb21wb25lbnRzKTtcblxuLy8gQ2hlY2tzIGV2ZXJ5IGluamVjdGlvbiBpZiBpdCBpcyBrbm93biB0byB0aGUgJGluamVjdG9yXG4vLyBJdCB3aWxsIHRoZW4gY2hlY2sgdGhlIHVua25vd24gaW5qZWN0cyBpZiB0aGVyZSBpcyBhbnkgcGFyZW50IGNvbXBvbmVudCB0aGF0IG1hdGNoZXNcbi8vIHRoZSBuYW1lLiBJZiBhIG1hdGNoaW5nIGNvbXBvbmVudCB3YXMgZm91bmQgaXQgd2lsbCBpbmplY3QgdGhhdCBjb21wb25lbnQgYXMgYVxuLy8gbG9jYWwuXG5mdW5jdGlvbiBpbmplY3RQYXJlbnRDb21wb25lbnRzKGNhbGxlcjogYW55LCBpbmplY3RzOiBzdHJpbmdbXSwgY29udHJvbGxlcjogYW55LCBkZG86IGFueSwgJGluamVjdG9yOiBhbnksIGxvY2FsczogYW55KSB7XG5cdGluamVjdHMuZm9yRWFjaCgoaW5qZWN0KSA9PiB7XG5cdFx0aWYgKCEkaW5qZWN0b3IuaGFzKGluamVjdCkpIHtcblx0XHRcdGxldCBwYXJlbnQgPSBsb2NhbHMuJGVsZW1lbnQ7XG5cblx0XHRcdGRvIHtcblx0XHRcdFx0aWYgKCFwYXJlbnQuY29udHJvbGxlcikgY29udGludWU7XG5cdFx0XHRcdGNvbnN0IHBhcmVudEN0cmwgPSBwYXJlbnQuY29udHJvbGxlcihpbmplY3QpO1xuXHRcdFx0XHRpZiAocGFyZW50Q3RybCkge1xuXHRcdFx0XHRcdGxvY2Fsc1tpbmplY3RdID0gcGFyZW50Q3RybDtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH0gd2hpbGUgKChwYXJlbnQgPSBwYXJlbnQucGFyZW50KCkpICYmIHBhcmVudC5sZW5ndGggPiAwKTtcblx0XHR9XG5cdH0pO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
