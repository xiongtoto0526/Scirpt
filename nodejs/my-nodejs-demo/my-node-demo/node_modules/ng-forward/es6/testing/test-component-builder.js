import bundle from '../bundle';
import { allProviders, clearProviders } from './providers';
import { bundleStore, componentStore } from '../writers';
import { View } from '../decorators/component';
export class TestComponentBuilder {
    create(rootComponent) {
        let decoratedModule = bundle('test.module', rootComponent);
        angular.mock.module(decoratedModule.name);
        angular.mock.module($provide => allProviders().forEach(({ token, useValue }) => $provide.value(token, useValue)));
        let fixture = compileComponent(rootComponent);
        clearProviders();
        return fixture;
    }
    createAsync(rootComponent) {
        let fixture = this.create(rootComponent);
        return Promise.resolve(fixture);
    }
    overrideTemplate(component, template) {
        componentStore.set('template', template, component);
        return this;
    }
    overrideProviders(component, providers) {
        bundleStore.set('providers', providers, component);
        return this;
    }
    overrideView(component, config) {
        View(config)(component);
        return this;
    }
    overrideDirective() { throw new Error('Method not supported in ng-forward.'); }
    overrideViewBindings() { throw new Error('Method not supported in ng-forward.'); }
}
export class ComponentFixture {
    constructor({ debugElement, rootTestScope, $injector }) {
        this.debugElement = debugElement;
        this.debugElement.data('$injector', $injector);
        this.componentInstance = debugElement.componentInstance;
        this.nativeElement = debugElement.nativeElement;
        this.rootTestScope = rootTestScope;
    }
    detectChanges() {
        this.rootTestScope.$digest();
    }
}
export function compileComponent(ComponentClass) {
    let selector = bundleStore.get('selector', ComponentClass), rootTestScope, debugElement, componentInstance, $injector;
    inject(($compile, $rootScope, _$injector_) => {
        let controllerAs = componentStore.get('controllerAs', ComponentClass);
        componentInstance = new ComponentClass();
        rootTestScope = $rootScope.$new();
        debugElement = angular.element(`<${selector}></${selector}>`);
        debugElement = $compile(debugElement)(rootTestScope);
        rootTestScope.$digest();
        $injector = _$injector_;
    });
    return new ComponentFixture({ debugElement, rootTestScope, $injector });
}
export function compileHtmlAndScope({ html, initialScope, selector }) {
    let parentScope, element, controller, isolateScope;
    inject(($compile, $rootScope) => {
        parentScope = $rootScope.$new();
        Object.assign(parentScope, initialScope);
        element = angular.element(html);
        element = $compile(element)(parentScope);
        parentScope.$digest();
        isolateScope = element.isolateScope();
        controller = element.controller(`${selector}`);
    });
    return { parentScope, element, controller, isolateScope };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90ZXN0aW5nL3Rlc3QtY29tcG9uZW50LWJ1aWxkZXIudHMiXSwibmFtZXMiOlsiVGVzdENvbXBvbmVudEJ1aWxkZXIiLCJUZXN0Q29tcG9uZW50QnVpbGRlci5jcmVhdGUiLCJUZXN0Q29tcG9uZW50QnVpbGRlci5jcmVhdGVBc3luYyIsIlRlc3RDb21wb25lbnRCdWlsZGVyLm92ZXJyaWRlVGVtcGxhdGUiLCJUZXN0Q29tcG9uZW50QnVpbGRlci5vdmVycmlkZVByb3ZpZGVycyIsIlRlc3RDb21wb25lbnRCdWlsZGVyLm92ZXJyaWRlVmlldyIsIlRlc3RDb21wb25lbnRCdWlsZGVyLm92ZXJyaWRlRGlyZWN0aXZlIiwiVGVzdENvbXBvbmVudEJ1aWxkZXIub3ZlcnJpZGVWaWV3QmluZGluZ3MiLCJDb21wb25lbnRGaXh0dXJlIiwiQ29tcG9uZW50Rml4dHVyZS5jb25zdHJ1Y3RvciIsIkNvbXBvbmVudEZpeHR1cmUuZGV0ZWN0Q2hhbmdlcyIsImNvbXBpbGVDb21wb25lbnQiLCJjb21waWxlSHRtbEFuZFNjb3BlIl0sIm1hcHBpbmdzIjoiT0FBTyxNQUFNLE1BQU0sV0FBVztPQUV2QixFQUFhLFlBQVksRUFBRSxjQUFjLEVBQUUsTUFBTSxhQUFhO09BQzlELEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxNQUFNLFlBQVk7T0FDakQsRUFBRSxJQUFJLEVBQUUsTUFBTSx5QkFBeUI7QUFlOUM7SUFVVUEsTUFBTUEsQ0FBQ0EsYUFBc0JBO1FBQ25DQyxJQUFJQSxlQUFlQSxHQUFvQkEsTUFBTUEsQ0FBQ0EsYUFBYUEsRUFBRUEsYUFBYUEsQ0FBQ0EsQ0FBQ0E7UUFDNUVBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxJQUV4QkEsWUFBWUEsRUFBRUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0Es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LEVBQUVBLENBQUNBLENBQUNBO0lBQ2pEQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUVIQSxNQUFNQSxDQUFDQSxFQUFDQSxXQUFXQSxFQUFFQSxPQUFPQSxFQUFFQSxVQUFVQSxFQUFFQSxZQUFZQSxFQUFDQSxDQUFDQTtBQUMxREEsQ0FBQ0EiLCJmaWxlIjoibGliL3Rlc3RpbmcvdGVzdC1jb21wb25lbnQtYnVpbGRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBidW5kbGUgZnJvbSAnLi4vYnVuZGxlJztcbmltcG9ydCB7IFByb3ZpZGVycyB9IGZyb20gJy4uL2RlY29yYXRvcnMvcHJvdmlkZXJzJztcbmltcG9ydCB7IHByb3ZpZGVycywgYWxsUHJvdmlkZXJzLCBjbGVhclByb3ZpZGVycyB9IGZyb20gJy4vcHJvdmlkZXJzJztcbmltcG9ydCB7IGJ1bmRsZVN0b3JlLCBjb21wb25lbnRTdG9yZSB9IGZyb20gJy4uL3dyaXRlcnMnO1xuaW1wb3J0IHsgVmlldyB9IGZyb20gJy4uL2RlY29yYXRvcnMvY29tcG9uZW50J1xuaW1wb3J0IHtJTmdGb3J3YXJkSlF1ZXJ5fSBmcm9tIFwiLi4vdXRpbC9qcWxpdGUtZXh0ZW5zaW9uc1wiO1xuaW1wb3J0IElJbmplY3RvclNlcnZpY2UgPSBhbmd1bGFyLmF1dG8uSUluamVjdG9yU2VydmljZTtcbmltcG9ydCB7RGVjb3JhdGVkTW9kdWxlfSBmcm9tIFwiLi4vY2xhc3Nlcy9tb2R1bGVcIjtcblxuZXhwb3J0IGludGVyZmFjZSBuZ0NsYXNzIHtcbiAgbmV3ICguLi5hbnkpOiBhbnk7XG4gIG5hbWU/OnN0cmluZztcbn1cblxuLyoqXG4gKiBUZXN0Q29tcG9uZW50QnVpbGRlclxuICpcbiAqIFRoZSBwcmVmZXJyZWQgd2F5IHRvIHRlc3QgY29tcG9uZW50c1xuICovXG5leHBvcnQgY2xhc3MgVGVzdENvbXBvbmVudEJ1aWxkZXIge1xuICAvKipcbiAgICogVGFrZXMgYSByb290IGNvbXBvbmVudCwgdHlwaWNhbGx5IGEgdGVzdCBjb21wb25lbnQgd2hvc2UgdGVtcGxhdGUgaG91c2VzIGFub3RoZXIgY29tcG9uZW50XG4gICAqIHVuZGVyIHRlc3QuIFJldHVybnMgYSBDb21wb25lbnRGaXh0dXJlIHRoYXQgY29udGFpbnMgYSBkZWJ1Z0VsZW1lbnQgcmVmZXJlbmNlXG4gICAqIHRvIHRoZSB0ZXN0IGNvbXBvbmVudCAod2hpY2ggeW91IGNhbiB1c2UgdG8gZHJpbGwgZG93biB0byB0aGUgY29tcG9uZW50IHVuZGVyIHRlc3QpIGFzIHdlbGxcbiAgICogYXMgYSBkZXRlY3RDaGFuZ2VzIG1ldGhvZCB3aGljaCBhbGlhc2VzIHRvIGEgc2NvcGUgZGlnZXN0IGNhbGwuXG4gICAqXG4gICAqIEBwYXJhbSByb290Q29tcG9uZW50XG4gICAqIEByZXR1cm5zIHtDb21wb25lbnRGaXh0dXJlfVxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGUocm9vdENvbXBvbmVudDogbmdDbGFzcyk6IENvbXBvbmVudEZpeHR1cmUge1xuICAgIGxldCBkZWNvcmF0ZWRNb2R1bGU6IERlY29yYXRlZE1vZHVsZSA9IGJ1bmRsZSgndGVzdC5tb2R1bGUnLCByb290Q29tcG9uZW50KTtcbiAgICBhbmd1bGFyLm1vY2subW9kdWxlKGRlY29yYXRlZE1vZHVsZS5uYW1lKTtcbiAgICBhbmd1bGFyLm1vY2subW9kdWxlKCRwcm92aWRlID0+XG4gICAgLy8gdG9kbzogc3VwcG9ydCBhbGwgcHJvdmlkZXJzLCBub3QganVzdCB1c2VWYWx1ZSBvbmVzXG4gICAgICAgIGFsbFByb3ZpZGVycygpLmZvckVhY2goKHt0b2tlbiwgdXNlVmFsdWV9KSA9PlxuICAgICAgICAgICAgJHByb3ZpZGUudmFsdWUodG9rZW4sIHVzZVZhbHVlKSkpO1xuXG4gICAgbGV0IGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmUgPSBjb21waWxlQ29tcG9uZW50KHJvb3RDb21wb25lbnQpO1xuICAgIGNsZWFyUHJvdmlkZXJzKCk7XG4gICAgcmV0dXJuIGZpeHR1cmU7XG4gIH1cblxuICAvKipcbiAgICogVGFrZXMgYSByb290IGNvbXBvbmVudCwgdHlwaWNhbGx5IGEgdGVzdCBjb21wb25lbnQgd2hvc2UgdGVtcGxhdGUgaG91c2VzIGFub3RoZXIgY29tcG9uZW50XG4gICAqIHVuZGVyIHRlc3QuIFJldHVybnMgYSBDb21wb25lbnRGaXh0dXJlIHRoYXQgY29udGFpbnMgYSBkZWJ1Z0VsZW1lbnQgcmVmZXJlbmNlXG4gICAqIHRvIHRoZSB0ZXN0IGNvbXBvbmVudCAod2hpY2ggeW91IGNhbiB1c2UgdG8gZHJpbGwgZG93biB0byB0aGUgY29tcG9uZW50IHVuZGVyIHRlc3QpIGFzIHdlbGxcbiAgICogYXMgYSBkZXRlY3RDaGFuZ2VzIG1ldGhvZCB3aGljaCBhbGlhc2VzIHRvIGEgc2NvcGUgZGlnZXN0IGNhbGwuXG4gICAqXG4gICAqIEBwYXJhbSByb290Q29tcG9uZW50XG4gICAqIEByZXR1cm5zIHtQcm9taXNlPENvbXBvbmVudEZpeHR1cmU+fVxuICAgICAqL1xuICBjcmVhdGVBc3luYyhyb290Q29tcG9uZW50OiBuZ0NsYXNzKTogUHJvbWlzZTxDb21wb25lbnRGaXh0dXJlPiB7XG4gICAgbGV0IGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmUgPSB0aGlzLmNyZWF0ZShyb290Q29tcG9uZW50KTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZpeHR1cmUpO1xuICB9XG5cbiAgb3ZlcnJpZGVUZW1wbGF0ZShjb21wb25lbnQ6IG5nQ2xhc3MsIHRlbXBsYXRlOiBzdHJpbmcpOiBUZXN0Q29tcG9uZW50QnVpbGRlciB7XG4gICAgY29tcG9uZW50U3RvcmUuc2V0KCd0ZW1wbGF0ZScsIHRlbXBsYXRlLCBjb21wb25lbnQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgb3ZlcnJpZGVQcm92aWRlcnMoY29tcG9uZW50OiBuZ0NsYXNzLCBwcm92aWRlcnM6IChuZ0NsYXNzfHN0cmluZylbXSk6IFRlc3RDb21wb25lbnRCdWlsZGVyIHtcbiAgICBidW5kbGVTdG9yZS5zZXQoJ3Byb3ZpZGVycycsIHByb3ZpZGVycywgY29tcG9uZW50KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG92ZXJyaWRlVmlldyhjb21wb25lbnQ6IG5nQ2xhc3MsIGNvbmZpZzoge1xuICAgIHRlbXBsYXRlPzogc3RyaW5nLFxuICAgIHRlbXBsYXRlVXJsPzogc3RyaW5nLFxuICAgIHBpcGVzPzogYW55W10sXG4gICAgZGlyZWN0aXZlcz86IG5nQ2xhc3NbXVxuICB9KTogVGVzdENvbXBvbmVudEJ1aWxkZXIge1xuICAgIFZpZXcoY29uZmlnKShjb21wb25lbnQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgb3ZlcnJpZGVEaXJlY3RpdmUoKSAgICAgeyB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBub3Qgc3VwcG9ydGVkIGluIG5nLWZvcndhcmQuJyk7IH1cbiAgb3ZlcnJpZGVWaWV3QmluZGluZ3MoKSAgeyB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBub3Qgc3VwcG9ydGVkIGluIG5nLWZvcndhcmQuJyk7IH1cbn1cblxuXG4vKipcbiAqIENvbXBvbmVudEZpeHR1cmUgaXMgd2hhdCBpcyByZXR1cm5lZCBmcm9tIGEgVGVzdENvbXBvbmVudEJ1aWxkZXIuY3JlYXRlIGNhbGwuXG4gKiBJdCBnaXZlcyBhY2Nlc3MgdG8gdGhlIHJvb3QgdGVzdCBkZWJ1ZyBlbGVtZW50LCB3aGljaCBpbiB0dXJuIGdpdmVzIGFjY2VzcyB0b1xuICogY29tcG9uZW50IGluc3RhbmNlLCBjaGlsZHJlbiBhbmQgYW5ndWxhciBlbGVtZW50IG1ldGhvZHMuIEFsc28gaGFzIGEgZGV0ZWN0Q2hhbmdlc1xuICogbWV0aG9kIHRoYXQgdHJpZ2dlcnMgYSBkaWdlc3QuXG4gKi9cbmV4cG9ydCBjbGFzcyBDb21wb25lbnRGaXh0dXJlIHtcbiAgcHVibGljIGRlYnVnRWxlbWVudDogSU5nRm9yd2FyZEpRdWVyeTtcbiAgcHVibGljIGNvbXBvbmVudEluc3RhbmNlOiBhbnk7XG4gIHB1YmxpYyBuYXRpdmVFbGVtZW50OiBhbnk7XG4gIHByaXZhdGUgcm9vdFRlc3RTY29wZTogbmcuSVNjb3BlO1xuXG4gIGNvbnN0cnVjdG9yKHtcbiAgICAgICAgZGVidWdFbGVtZW50LFxuICAgICAgICByb290VGVzdFNjb3BlLFxuICAgICAgICAkaW5qZWN0b3JcbiAgICAgIH0gOlxuICAgICAge1xuICAgICAgICBkZWJ1Z0VsZW1lbnQ6SU5nRm9yd2FyZEpRdWVyeSxcbiAgICAgICAgcm9vdFRlc3RTY29wZTogbmcuSVNjb3BlLFxuICAgICAgICAkaW5qZWN0b3I6IElJbmplY3RvclNlcnZpY2VcbiAgICAgIH0pIHtcbiAgICB0aGlzLmRlYnVnRWxlbWVudCA9IGRlYnVnRWxlbWVudDtcbiAgICB0aGlzLmRlYnVnRWxlbWVudC5kYXRhKCckaW5qZWN0b3InLCAkaW5qZWN0b3IpO1xuICAgIHRoaXMuY29tcG9uZW50SW5zdGFuY2UgPSBkZWJ1Z0VsZW1lbnQuY29tcG9uZW50SW5zdGFuY2U7XG4gICAgdGhpcy5uYXRpdmVFbGVtZW50ID0gZGVidWdFbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICB0aGlzLnJvb3RUZXN0U2NvcGUgPSByb290VGVzdFNjb3BlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyaWdnZXJzIGEgcm9vdCB0ZXN0IHNjb3BlIGRpZ2VzdC5cbiAgICovXG4gIGRldGVjdENoYW5nZXMoKTogdm9pZCB7XG4gICAgdGhpcy5yb290VGVzdFNjb3BlLiRkaWdlc3QoKTtcbiAgfVxufVxuXG5cbi8qKlxuICogQSBmdW5jdGlvbiBmb3IgY29tcGlsaW5nIGEgZGVjb3JhdGVkIGNvbXBvbmVudCBpbnRvIGEgQ29tcG9uZW50Rml4dHVyZVxuICpcbiAqIEBwYXJhbSBDb21wb25lbnRDbGFzc1xuICogQHJldHVybnMge0NvbXBvbmVudEZpeHR1cmV9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb21waWxlQ29tcG9uZW50KENvbXBvbmVudENsYXNzOm5nQ2xhc3MpOiBDb21wb25lbnRGaXh0dXJlIHtcblxuICBsZXQgc2VsZWN0b3I6IHN0cmluZyA9IGJ1bmRsZVN0b3JlLmdldCgnc2VsZWN0b3InLCBDb21wb25lbnRDbGFzcyksXG4gICAgICByb290VGVzdFNjb3BlOiBuZy5JU2NvcGUsXG4gICAgICBkZWJ1Z0VsZW1lbnQ6IElOZ0ZvcndhcmRKUXVlcnksXG4gICAgICBjb21wb25lbnRJbnN0YW5jZTogYW55LFxuICAgICAgJGluamVjdG9yOiBJSW5qZWN0b3JTZXJ2aWNlO1xuXG4gIGluamVjdCgoJGNvbXBpbGUsICRyb290U2NvcGUsIF8kaW5qZWN0b3JfKSA9PiB7XG4gICAgbGV0IGNvbnRyb2xsZXJBcyA9IGNvbXBvbmVudFN0b3JlLmdldCgnY29udHJvbGxlckFzJywgQ29tcG9uZW50Q2xhc3MpO1xuICAgIGNvbXBvbmVudEluc3RhbmNlID0gbmV3IENvbXBvbmVudENsYXNzKCk7XG4gICAgcm9vdFRlc3RTY29wZSA9ICRyb290U2NvcGUuJG5ldygpO1xuICAgIGRlYnVnRWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudChgPCR7c2VsZWN0b3J9PjwvJHtzZWxlY3Rvcn0+YCk7XG4gICAgZGVidWdFbGVtZW50ID0gJGNvbXBpbGUoZGVidWdFbGVtZW50KShyb290VGVzdFNjb3BlKTtcbiAgICByb290VGVzdFNjb3BlLiRkaWdlc3QoKTtcbiAgICAkaW5qZWN0b3IgPSBfJGluamVjdG9yXztcbiAgfSk7XG5cbiAgcmV0dXJuIG5ldyBDb21wb25lbnRGaXh0dXJlKHtkZWJ1Z0VsZW1lbnQsIHJvb3RUZXN0U2NvcGUsICRpbmplY3Rvcn0pO1xufVxuXG5cbi8qKlxuICogQSBmdW5jdGlvbiBmb3IgY29tcGlsaW5nIGFuIGh0bWwgdGVtcGxhdGUgYWdhaW5zdCBhIGRhdGEgb2JqZWN0LiBUaGlzIGlzXG4gKiBmb3IgdGVzdGluZyBkaXJlY3RpdmVzIGluIHJlZ3VsYXIgYW5ndWxhciAxLiBObyBkZXBlbmRlbmNpZXMgb24gdGhlXG4gKiBuZy1mb3J3YXJkLlxuICpcbiAqIFJlY29tbWVuZGVkIHRvIHVzZSBUZXN0Q29tcG9uZW50QnVpbGRlciBpbnN0ZWFkIGlmIHlvdSBhcmUgdXNpbmcgbmctZm9yd2FyZC5cbiAqXG4gKiBAcGFyYW0gaHRtbFxuICogQHBhcmFtIGluaXRpYWxTY29wZVxuICogQHBhcmFtIHNlbGVjdG9yXG4gKiBAcmV0dXJucyB7e3BhcmVudFNjb3BlOiAqLCBlbGVtZW50OiAqLCBjb250cm9sbGVyOiAqLCBpc29sYXRlU2NvcGU6ICp9fVxuICovXG5leHBvcnQgZnVuY3Rpb24gY29tcGlsZUh0bWxBbmRTY29wZSh7aHRtbCwgaW5pdGlhbFNjb3BlLCBzZWxlY3Rvcn0pe1xuXG4gIGxldCBwYXJlbnRTY29wZSwgZWxlbWVudCwgY29udHJvbGxlciwgaXNvbGF0ZVNjb3BlO1xuXG4gIGluamVjdCgoJGNvbXBpbGUsICRyb290U2NvcGUpID0+IHtcbiAgICBwYXJlbnRTY29wZSA9ICRyb290U2NvcGUuJG5ldygpO1xuICAgIE9iamVjdC5hc3NpZ24ocGFyZW50U2NvcGUsIGluaXRpYWxTY29wZSk7XG4gICAgZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudChodG1sKTtcbiAgICBlbGVtZW50ID0gJGNvbXBpbGUoZWxlbWVudCkocGFyZW50U2NvcGUpO1xuICAgIHBhcmVudFNjb3BlLiRkaWdlc3QoKTtcbiAgICBpc29sYXRlU2NvcGUgPSBlbGVtZW50Lmlzb2xhdGVTY29wZSgpO1xuICAgIGNvbnRyb2xsZXIgPSBlbGVtZW50LmNvbnRyb2xsZXIoYCR7c2VsZWN0b3J9YCk7XG4gIH0pO1xuXG4gIHJldHVybiB7cGFyZW50U2NvcGUsIGVsZW1lbnQsIGNvbnRyb2xsZXIsIGlzb2xhdGVTY29wZX07XG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
